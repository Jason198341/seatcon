/**
 * 모바일 브라우저 Viewport 문제 해결을 위한 스타일시트
 * 
 * viewport 높이(vh) 계산 문제를 해결하기 위한 CSS 변수 기반 접근법입니다.
 * 특히 iOS Safari에서 브라우저 하단 UI로 인한 문제를 해결합니다.
 */

:root {
    /* 기본 변수 정의 (JavaScript에서 동적으로 설정됨) */
    --vh: 1vh;
    --window-height: 100vh;
    --keyboard-height: 0px;
    --chat-input-height: 56px;
    --chat-header-height: 35px;
    --bottom-nav-spacing: 60px; /* 브라우저 하단 UI 공간 */
}

/* 실제 안전한 높이 계산 사용 */
.chat-container {
    height: calc(var(--window-height) - var(--header-height) - 1rem) !important;
    max-height: calc(var(--window-height) - var(--header-height) - 1rem) !important;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

/* 메시지 영역에 안전한 스크롤 영역 제공 */
.message-list {
    height: calc(var(--window-height) - var(--header-height) - var(--chat-header-height) - var(--chat-input-height) - var(--bottom-nav-spacing) - 1rem) !important;
    overflow-y: auto;
    flex: 1;
    margin-bottom: 0;
    padding-bottom: 16px; /* 충분한 하단 여백 */
    scrollbar-width: thin;
}

/* 메시지 입력창 고정 위치 설정 */
.message-form {
    position: sticky !important;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 100;
    background-color: var(--background);
    border-top: 1px solid var(--border);
    padding: 8px 12px;
    box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.1);
    height: var(--chat-input-height);
    min-height: var(--chat-input-height);
    transform: translateZ(0); /* 하드웨어 가속 활성화 */
    transition: transform 0.2s ease;
}

/* 키보드가 열렸을 때 입력창 위치 조정 (iOS Safari) */
body.keyboard-open .message-form {
    position: fixed !important;
    bottom: var(--keyboard-height) !important;
    transform: translateZ(0); /* 하드웨어 가속 활성화 */
}

/* 키보드가 열렸을 때 스크롤 조정 (iOS Safari) */
body.keyboard-open .message-list {
    height: calc(var(--window-height) - var(--header-height) - var(--chat-header-height) - var(--chat-input-height) - var(--keyboard-height)) !important;
    padding-bottom: calc(16px + var(--keyboard-height));
}

/* 다크모드 추가 스타일 */
.theme-dark .message-form {
    background-color: #1a1d21;
    box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.2);
}

/* 테마 전환 시 부드러운 변경 */
.message-form {
    transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
}

/* 메시지 입력창 내부 요소 정렬 */
.message-input-container {
    flex: 1;
    position: relative;
}

/* 하단 내비게이션 바가 있는 경우 추가 여백 */
@media (max-width: 767px) {
    .chat-container {
        padding-bottom: var(--bottom-nav-spacing);
    }
    
    /* 하단에 안전 영역 추가 */
    .message-form {
        margin-bottom: var(--bottom-nav-spacing);
    }
}

/* 키보드 높이 변경 애니메이션 최적화 */
@media (max-width: 767px) {
    * {
        transition-duration: 0.2s !important;
    }
    
    .message-form {
        will-change: transform;
    }
    
    .chat-container, 
    .message-list {
        will-change: height;
    }
}